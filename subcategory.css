<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Subcategory Manager - Mobile Preview</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
      integrity="sha512-RvQxD1xX9Z+nq87shL6oI6+3w+OkMDWimk3L0m3vT/cslS+9f5TjL44z4Qjwhh69f7gD8mKjIfd1z+7klXJpHg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Poppins", sans-serif;
        font-size: 14px;
        background: #f5f5f5;
      }

      /* Navbar */
      .navbar {
        background-color: #1DA1F2;
        padding: 8px 15px;
        color: white;
        position: fixed;
        width: 100%;
        top: 0;
        z-index: 1000;
      }

      .nav-inner {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .logo svg {
        margin-right: 8px;
      }

      .brand-name {
        font-size: 16px;
        font-weight: bold;
      }

      .nav-actions {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .dashboard-pill {
        display: flex;
        align-items: center;
        color: white;
        text-decoration: none;
        font-size: 13px;
        margin-right: 10px;
      }

      .dashboard-pill svg {
        margin-right: 4px;
      }

      .profile {
        position: relative;
      }

      .profile-trigger img {
        cursor: pointer;
        width: 28px;
        height: 28px;
        border-radius: 50%;
      }

      .profile-dropdown {
        display: none;
        position: absolute;
        right: 0;
        top: 100%;
        background: white;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        min-width: 120px;
        z-index: 1000;
      }

      .profile-dropdown ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .profile-dropdown li a {
        display: block;
        padding: 8px;
        color: #333;
        text-decoration: none;
        font-size: 12px;
      }

      .profile-dropdown li a:hover {
        background-color: #f5f5f5;
      }

      /* Main Container */
      .container {
        max-width: 1200px;
        margin: 60px auto 20px;
        padding: 15px;
      }

      /* Subcategory Banner */
      .subcategory-banner {
        background: linear-gradient(90deg, #007bff, #6f42c1);
        color: white;
        padding: 20px;
        text-align: center;
        border-radius: 8px;
        margin-bottom: 15px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      }

      .subcategory-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 6px;
      }

      .subcategory-title {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .subcategory-icon svg {
        color: white;
      }

      .subcategory-banner h1 {
        font-size: 20px;
        font-weight: 700;
        margin: 0;
      }

      .subcategory-banner p {
        font-size: 12px;
        opacity: 0.9;
        margin: 0;
      }

      /* Search and Stats */
      .search-stats-wrapper {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin: 15px 0;
      }

      .search-container {
        background-color: #FFFFFF;
        padding: 8px;
        border-radius: 6px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        width: 100%;
      }

      .search-bar {
        display: flex;
        align-items: center;
        width: 100%;
      }

      .search {
        color: #1DA1F2;
        font-size: 14px;
        font-weight: bold;
        margin-right: 8px;
      }

      .search-bar svg {
        margin-right: 6px;
      }

      .search-bar input {
        flex: 1;
        padding: 6px;
        border: 1px solid #CED4DA;
        border-radius: 4px;
        font-size: 12px;
      }

      .stats-container {
        width: 100%;
      }

      .card {
        background: #FFFFFF;
        border-radius: 8px;
        padding: 12px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        text-align: center;
        width: 100%;
      }

      .card h3 {
        font-size: 14px;
        font-weight: 600;
        color: #007bff;
        margin-bottom: 8px;
      }

      .total-box {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        background: linear-gradient(90deg, #007bff, #6f42c1);
        color: white;
        padding: 5px 12px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 12px;
        margin-bottom: 8px;
      }

      .total-box svg {
        width: 12px;
        height: 12px;
      }

      .buttons {
        display: flex;
        gap: 6px;
        justify-content: center;
      }

      .btn {
        padding: 5px 10px;
        font-size: 12px;
        border-radius: 5px;
        border: none;
        cursor: pointer;
        touch-action: manipulation;
      }

      .btn-import {
        background-color: #28a745;
        color: white;
      }

      .btn-export {
        background-color: #007bff;
        color: white;
      }

      /* Filter and Sort */
      .filter-sort-container {
        margin: 15px 0;
        background: #fff;
        padding: 10px;
        border-radius: 6px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .filter-sort-header {
        display: flex;
        align-items: center;
        gap: 5px;
        margin-bottom: 8px;
      }

      .filter-sort-label {
        font-weight: bold;
        color: #1DA1F2;
        font-size: 14px;
      }

      .filter-sort-content {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .filter-sort-options {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .pill, .category-select, .sort-select {
        padding: 6px 10px;
        border: 1px solid #CED4DA;
        border-radius: 15px;
        background: #fff;
        font-size: 12px;
        width: 100%;
      }

      .category-select:focus, .sort-select:focus {
        outline: none;
        border-color: #1DA1F2;
      }

      .actions {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .btn.apply {
        background-color: #A461D8;
        color: white;
      }

      .btn.add-new-btn {
        background-color: #6f42c1;
        color: white;
      }

      /* Table */
      .category-table {
        width: 100%;
        border-collapse: collapse;
        background: #FFFFFF;
        border-radius: 6px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .category-table th,
      .category-table td {
        padding: 8px;
        text-align: left;
        border-bottom: 1px solid #E1E8ED;
        font-size: 12px;
      }

      .category-table th {
        background-color: #F5F8FA;
        color: #657786;
      }

      .category-table td img {
        width: 40px;
        height: 40px;
        object-fit: cover;
      }

      .edit-subcategory,
      .delete-subcategory {
        padding: 4px 8px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 11px;
      }

      .edit-subcategory {
        background-color: #1e88e5;
        color: white;
      }

      .delete-subcategory {
        background-color: #ff4444;
        color: white;
      }

      /* Popups and Modals */
      .profile-popup, .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .popup-inner, .modal-content {
        background: white;
        padding: 15px;
        border-radius: 6px;
        width: 90%;
        max-width: 400px;
        max-height: 80vh;
        overflow-y: auto;
      }

      .popup-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .popup-header h2 {
        font-size: 16px;
        margin: 0;
      }

      .close-btn, .close {
        background: none;
        border: none;
        font-size: 20px;
        cursor: pointer;
      }

      .image-container {
        text-align: center;
        margin-bottom: 15px;
      }

      .image-container img {
        width: 100px;
        height: 100px;
        object-fit: cover;
      }

      .image-btn {
        margin-top: 8px;
        padding: 4px 8px;
        background-color: #1DA1F2;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
      }

      .ecommerce-form .form-group {
        margin-bottom: 10px;
      }

      .ecommerce-form label {
        display: block;
        font-size: 12px;
        margin-bottom: 4px;
      }

      .ecommerce-form input,
      .ecommerce-form select {
        width: 100%;
        padding: 6px;
        border: 1px solid #CED4DA;
        border-radius: 4px;
        font-size: 12px;
      }

      .form-actions {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .save-btn {
        background-color: #1DA1F2;
        color: white;
      }

      .cancel-btn {
        background-color: #E1E8ED;
        color: #1DA1F2;
      }

      .modal-content h2 {
        font-size: 16px;
        color: #333;
        margin-bottom: 10px;
      }

      .modal-content label {
        font-weight: 600;
        font-size: 12px;
        margin-bottom: 4px;
      }

      .modal-content input[type="file"] {
        padding: 6px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }

      .hint {
        font-size: 11px;
        color: #666;
        margin-bottom: 10px;
      }

      .hint code {
        background: #f1f1f1;
        padding: 2px 4px;
        border-radius: 3px;
      }

      .checkbox-row {
        display: flex;
        align-items: center;
        gap: 6px;
        margin-bottom: 8px;
      }

      .checkbox-row input[type="checkbox"] {
        width: 14px;
        height: 14px;
        accent-color: #1DA1F2;
      }

      .checkbox-row label {
        font-size: 12px;
        color: #444;
      }

      .warning {
        background: #fff3cd;
        border: 1px solid #ffeeba;
        padding: 8px;
        border-radius: 4px;
        font-size: 11px;
        color: #856404;
        margin-bottom: 10px;
      }

      .modal-actions {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .btn-cancel {
        background: #e0e0e0;
      }

      .btn-blue {
        background: #007bff;
        color: white;
      }

      /* Footer */
      .footer {
        text-align: center;
        padding: 15px;
        color: #657786;
        font-size: 11px;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .nav-inner {
          flex-direction: column;
          align-items: flex-start;
        }

        .nav-actions {
          flex-direction: column;
          width: 100%;
          margin-top: 8px;
        }

        .dashboard-pill, .profile {
          width: 100%;
          text-align: center;
          margin: 4px 0;
        }

        .profile-dropdown {
          position: static;
          width: 100%;
          box-shadow: none;
        }

        .profile-dropdown ul {
          width: 100%;
        }

        .profile-dropdown li {
          text-align: center;
        }
      }

      @media (max-width: 600px) {
        .navbar {
          padding: 6px 10px;
        }

        .brand-name {
          font-size: 14px;
        }

        .dashboard-pill {
          font-size: 12px;
        }

        .dashboard-pill svg {
          width: 12px;
          height: 12px;
        }

        .profile-trigger img {
          width: 24px;
          height: 24px;
        }

        .container {
          margin-top: 50px;
          padding: 10px;
        }

        .subcategory-banner {
          padding: 15px;
        }

        .subcategory-banner h1 {
          font-size: 18px;
        }

        .subcategory-banner p {
          font-size: 11px;
        }

        .search-stats-wrapper {
          margin: 10px 0;
        }

        .search-container, .stats-container {
          margin: 8px 0;
        }

        .search {
          font-size: 13px;
        }

        .search-bar input {
          font-size: 11px;
          padding: 5px;
        }

        .card h3 {
          font-size: 13px;
        }

        .total-box {
          font-size: 11px;
          padding: 4px 10px;
        }

        .buttons {
          flex-direction: column;
        }

        .btn {
          width: 100%;
          margin: 4px 0;
        }

        .filter-sort-options {
          flex-direction: column;
        }

        .category-select, .sort-select {
          max-width: none;
        }

        .actions {
          flex-direction: column;
        }

        .actions .btn {
          width: 100%;
        }

        .category-table th,
        .category-table td {
          padding: 6px;
          font-size: 11px;
        }

        .category-table td img {
          width: 30px;
          height: 30px;
        }

        .edit-subcategory,
        .delete-subcategory {
          padding: 3px 6px;
          font-size: 10px;
        }

        .popup-inner, .modal-content {
          width: 95%;
          padding: 10px;
        }

        .popup-header h2 {
          font-size: 14px;
        }

        .image-container img {
          width: 80px;
          height: 80px;
        }

        .form-actions {
          flex-direction: column;
        }

        .form-actions button {
          width: 100%;
          margin: 4px 0;
        }

        .footer {
          font-size: 10px;
        }
      }

      @media (max-width: 400px) {
        .brand-name {
          font-size: 12px;
        }

        .subcategory-banner h1 {
          font-size: 16px;
        }

        .subcategory-banner p {
          font-size: 10px;
        }

        .category-table th,
        .category-table td {
          padding: 4px;
          font-size: 10px;
        }

        .category-table td img {
          width: 25px;
          height: 25px;
        }
      }
    </style>
  </head>
  <body>
    <!-- NAVBAR -->
    <header class="navbar">
      <div class="nav-inner">
        <div class="brand">
          <div class="logo">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              fill="white"
              class="bi bi-check2-square"
              viewBox="0 0 16 16"
            >
              <path
                d="M3 14.5A1.5 1.5 0 0 1 1.5 13V3A1.5 1.5 0 0 1 3 1.5h8a.5.5 0 0 1 0 1H3a.5.5 0 0 0-.5.5v10a.5.5 0 0 0 .5.5h10a.5.5 0 0 0 .5-.5V8a.5.5 0 0 1 1 0v5a1.5 1.5 0 0 1-1.5 1.5z"
              />
              <path
                d="m8.354 10.354 7-7a.5.5 0 0 0-.708-.708L8 9.293 5.354 6.646a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0"
              />
            </svg>
          </div>
          <span class="brand-name">TaskPro</span>
        </div>
        <div class="nav-actions">
          <a href="dashboard.html" class="dashboard-pill">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="white"
              class="bi bi-house"
              viewBox="0 0 16 16"
            >
              <path
                d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5z"
              />
            </svg>
            <span class="dashboard-text">Dashboard</span>
          </a>
          <div class="profile" id="profile">
            <div id="profileIcon" class="profile-trigger">
              <img
                src="https://via.placeholder.com/28"
                alt="Profile"
              />
            </div>
            <div id="profileDropdown" class="profile-dropdown">
              <ul>
                <li><a href="#" id="editProfileLink">Edit</a></li>
                <li><a href="#" id="settingsLink">Settings</a></li>
                <li><a href="#" id="logoutLink">Logout</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Subcategory Manager Content -->
    <main class="container">
      <div class="subcategory-banner">
        <div class="subcategory-content">
          <div class="subcategory-title">
            <div class="subcategory-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                fill="white"
                viewBox="0 0 24 24"
              >
                <path
                  d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"
                  stroke="currentColor"
                  stroke-width="2"
                  fill="none"
                />
              </svg>
            </div>
            <h1>Manage Subcategories</h1>
          </div>
          <p>Organize your products into categories and subcategories</p>
        </div>
      </div>
      <div class="search-stats-wrapper">
        <div class="search-container">
          <div class="search-bar">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="14"
              height="14"
              fill="currentColor"
              class="bi bi-search"
              viewBox="0 0 16 16"
            >
              <path
                d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"
              />
            </svg>
            <span class="search">Search Subcategories</span>
            <input
              type="text"
              id="searchInput"
              placeholder="Search by name, category, or description..."
            />
          </div>
        </div>
        <div class="stats-container">
          <div class="card">
            <h3>Statistics</h3>
            <div class="total-box" id="totalSubcategories">Total: 0</div>
            <div class="buttons">
              <button class="btn btn-import">
                <i class="fas fa-upload"></i> Import
              </button>
              <button class="btn btn-export">
                <i class="fas fa-download"></i> Export
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="filter-sort-container">
        <div class="filter-sort-header">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            fill="currentColor"
            class="bi bi-funnel"
            viewBox="0 0 16 16"
          >
            <path
              d="M1.5 1.5A.5.5 0 0 1 2 1h12a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.128.334L10 8.692V13.5a.5.5 0 0 1-.342.474l-3 1A.5.5 0 0 1 6 14.5V8.692L1.628 3.834A.5.5 0 0 1 1.5 3.5zm1 .5v1.308l4.372 4.858A.5.5 0 0 1 7 8.5v5.306l2-.666V8.5a.5.5 0 0 1 .128-.334L13.5 3.308V2z"
            />
          </svg>
          <span class="filter-sort-label">Filter & Sort</span>
        </div>
        <div class="filter-sort-content">
          <div class="filter-sort-options">
            <select class="pill category-select" id="categorySelect">
              <option value="all">Category: All Categories</option>
              <!-- Categories will be populated dynamically -->
            </select>
            <select class="pill sort-select" id="sortSelect">
              <option value="default">Sort by: Default</option>
              <option value="name-asc">Name (A-Z)</option>
              <option value="name-desc">Name (Z-A)</option>
              <option value="price-asc">Price (Low to High)</option>
              <option value="price-desc">Price (High to Low)</option>
              <option value="newest">Newest First</option>
              <option value="oldest">Oldest First</option>
            </select>
          </div>
          <div class="actions">
            <button class="btn apply" id="applyFiltersBtn">‚úî Apply</button>
            <button id="addNewSubBtnFilter" class="btn add-new-btn">‚ûï Add New</button>
          </div>
        </div>
      </div>
      <table class="category-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>IMAGE</th>
            <th>CATEGORY</th>
            <th>SUBCATEGORY</th>
            <th>PRODUCT NAME</th>
            <th>PRICE</th>
            <th>QUANTITY</th>
            <th>DESCRIPTION</th>
            <th>ACTIONS</th>
          </tr>
        </thead>
        <tbody id="subcategoryTableBody">
          <!-- Sample data for preview -->
          <tr>
            <td>1</td>
            <td><img src="https://images.unsplash.com/photo-1600585154340-be6161a56a0c" alt="Potato" style="width: 40px; height: 40px; object-fit: cover;"></td>
            <td>Vegetables</td>
            <td>Root</td>
            <td>Fresh Potato</td>
            <td>$1.50</td>
            <td>100</td>
            <td>High-quality potatoes</td>
            <td>
              <button class="edit-subcategory" data-index="0">Edit</button>
              <button class="delete-subcategory" data-index="0">Delete</button>
            </td>
          </tr>
        </tbody>
      </table>
    </main>

    <!-- Add/Edit Subcategory Popup -->
    <div class="profile-popup" id="subcategoryPopup">
      <div class="popup-inner">
        <div class="popup-header">
          <h2 id="popupTitle">Add Subcategory</h2>
          <button class="close-btn" id="closePopupBtn">&times;</button>
        </div>
        <div class="image-container">
          <img
            id="subcategoryImg"
            src="https://images.unsplash.com/photo-1600585154340-be6161a56a0c"
            alt="Subcategory Image"
          />
          <input
            type="file"
            id="subcategoryPhotoInput"
            accept="image/*"
            style="display: none"
          />
          <button id="changeSubcategoryPhoto" class="image-btn">
            Change Image
          </button>
        </div>
        <form id="subcategoryForm" class="ecommerce-form">
          <div class="form-group">
            <label>Category</label>
            <select id="subcategoryCategory" required>
              <option value="vegetables">Vegetables</option>
              <!-- More options can be added dynamically -->
            </select>
          </div>
          <div class="form-group">
            <label>Subcategory</label>
            <input
              type="text"
              id="subcategoryName"
              required
              placeholder="e.g., Root"
            />
          </div>
          <div class="form-group">
            <label>Product Name</label>
            <input
              type="text"
              id="productName"
              required
              placeholder="e.g., Fresh Potato"
            />
          </div>
          <div class="form-group">
            <label>Price ($)</label>
            <input
              type="number"
              id="price"
              step="0.01"
              required
              placeholder="e.g., 1.50"
            />
          </div>
          <div class="form-group">
            <label>Quantity</label>
            <input
              type="number"
              id="quantity"
              required
              placeholder="e.g., 100"
            />
          </div>
          <div class="form-group">
            <label>Description</label>
            <input
              type="text"
              id="subcategoryDesc"
              required
              placeholder="e.g., High-quality potatoes"
            />
          </div>
          <div class="form-actions">
            <button type="submit" class="save-btn">Save</button>
            <button type="button" class="cancel-btn">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Edit Profile Popup -->
    <div class="profile-popup" id="profilePopup">
      <div class="popup-inner">
        <div class="popup-header">
          <h2>Edit Profile</h2>
          <button class="close-btn" id="closeProfilePopupBtn">&times;</button>
        </div>
        <div class="image-container">
          <img
            id="profileImg"
            src="https://via.placeholder.com/100"
            alt="Profile"
          />
          <input
            type="file"
            id="photoInput"
            accept="image/*"
            style="display: none"
          />
          <button id="changePhoto" class="image-btn">Change Photo</button>
        </div>
        <form id="profileForm" class="ecommerce-form">
          <div class="form-group">
            <label>Username</label>
            <input type="text" id="username" value="owner" />
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="email" value="owner@signaltone.com" />
          </div>
          <div class="form-actions">
            <button type="submit" class="save-btn">Save Changes</button>
            <button type="button" class="cancel-btn">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Import Modal -->
    <div id="importModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>üìÇ Import Subcategories from CSV</h2>
        <label for="csvFile">CSV File</label>
        <input type="file" id="csvFile" accept=".csv" />
        <p class="hint">
          CSV format: <code>category,subcategory,productName,price,description,image,quantity,createdAt</code> (image, quantity, and createdAt optional).
          <a href="#" id="downloadTemplate">Download template</a>
        </p>
        <div class="checkbox-row">
          <input type="checkbox" id="containsHeaders" checked />
          <label for="containsHeaders">First row contains headers</label>
        </div>
        <div class="warning">
          ‚ö†Ô∏è Existing subcategories with the same product name and category will be updated.<br />
          New subcategories will be added.
        </div>
        <div class="modal-actions">
          <button class="btn btn-cancel">Cancel</button>
          <button class="btn btn-blue" id="importSubcategoriesBtn">‚¨Ü Import Subcategories</button>
        </div>
      </div>
    </div>

    <!-- Export Modal -->
    <div id="exportModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Export subcategories to CSV</h2>
        <p>Click below to export all subcategories as a CSV file.</p>
        <button class="btn btn-blue" id="downloadCsvBtn">Download CSV</button>
      </div>
    </div>

    <footer class="footer">
      <small>¬©Ô∏è 2025 TaskPro ‚Äî Dashboard prototype (Last updated: 10:18 PM IST, Thursday, September 25, 2025)</small>
    </footer>

    <script>
      // Profile functionality
      const savedUsername = localStorage.getItem("username") || "owner";
      const savedEmail = localStorage.getItem("email") || "owner@signaltone.com";
      const savedProfileImg = localStorage.getItem("profileImg") || "https://via.placeholder.com/28";

      document.getElementById("username").value = savedUsername;
      document.getElementById("email").value = savedEmail;
      const profileIcon = document.getElementById("profileIcon");
      const profileImg = document.getElementById("profileImg");
      const profileTrigger = document.querySelector(".profile-trigger");
      const profilePopup = document.getElementById("profilePopup");
      const profileForm = document.getElementById("profileForm");
      const usernameInput = document.getElementById("username");
      const emailInput = document.getElementById("email");
      const photoInput = document.getElementById("photoInput");
      const changePhotoBtn = document.getElementById("changePhoto");
      const closeProfilePopupBtn = document.getElementById("closeProfilePopupBtn");
      const profileDropdown = document.getElementById("profileDropdown");
      const editProfileLink = document.getElementById("editProfileLink");
      const settingsLink = document.getElementById("settingsLink");
      const logoutLink = document.getElementById("logoutLink");

      profileImg.src = savedProfileImg;
      profileIcon.innerHTML = `<img src="${savedProfileImg}" alt="Profile" style="width: 28px; height: 28px; border-radius: 50%;">`;

      profileTrigger.addEventListener("click", (e) => {
        e.preventDefault();
        profileDropdown.style.display = profileDropdown.style.display === "block" ? "none" : "block";
      });

      editProfileLink.addEventListener("click", (e) => {
        e.preventDefault();
        profileDropdown.style.display = "none";
        profilePopup.style.display = "flex";
      });

      settingsLink.addEventListener("click", (e) => {
        e.preventDefault();
        profileDropdown.style.display = "none";
        alert("Settings page is not implemented yet.");
      });

      logoutLink.addEventListener("click", (e) => {
        e.preventDefault();
        profileDropdown.style.display = "none";
        if (confirm("Are you sure you want to logout?")) {
          localStorage.removeItem("username");
          localStorage.removeItem("email");
          localStorage.removeItem("profileImg");
          window.location.href = "index.html";
        }
      });

      changePhotoBtn.addEventListener("click", () => {
        photoInput.click();
      });

      photoInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (event) => {
            profileImg.src = event.target.result;
            profileIcon.innerHTML = `<img src="${event.target.result}" alt="Profile" style="width: 28px; height: 28px; border-radius: 50%;">`;
          };
          reader.readAsDataURL(file);
        }
      });

      profileForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const username = usernameInput.value;
        const email = emailInput.value;
        const profileImgSrc = profileImg.src;
        localStorage.setItem("username", username);
        localStorage.setItem("email", email);
        localStorage.setItem("profileImg", profileImgSrc);
        profileIcon.innerHTML = `<img src="${profileImgSrc}" alt="Profile" style="width: 28px; height: 28px; border-radius: 50%;">`;
        profilePopup.style.display = "none";
      });

      document.querySelector("#profilePopup .cancel-btn").addEventListener("click", () => {
        profilePopup.style.display = "none";
        usernameInput.value = localStorage.getItem("username") || "owner";
        emailInput.value = localStorage.getItem("email") || "owner@signaltone.com";
        profileImg.src = localStorage.getItem("profileImg") || "https://via.placeholder.com/100";
        profileIcon.innerHTML = `<img src="${profileImg.src}" alt="Profile" style="width: 28px; height: 28px; border-radius: 50%;">`;
      });

      closeProfilePopupBtn.addEventListener("click", () => {
        profilePopup.style.display = "none";
      });

      // Subcategory functionality
      let categories = JSON.parse(localStorage.getItem("categories")) || [];
      let subcategories = JSON.parse(localStorage.getItem("subcategories")) || [
        {
          category: "Vegetables",
          subcategory: "Root",
          productName: "Fresh Potato",
          price: 1.50,
          quantity: 100,
          desc: "High-quality potatoes",
          image: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c",
          createdAt: new Date().toISOString()
        }
      ];

      // Validate and normalize createdAt for subcategories
      subcategories = subcategories.map(sub => {
        const createdAt = sub.createdAt && !isNaN(new Date(sub.createdAt)) 
          ? sub.createdAt 
          : new Date().toISOString();
        return { ...sub, createdAt };
      });
      localStorage.setItem("subcategories", JSON.stringify(subcategories));

      const subcategoryTableBody = document.getElementById("subcategoryTableBody");
      const totalSubcategories = document.getElementById("totalSubcategories");
      const addNewSubBtn = document.getElementById("addNewSubBtnFilter");
      const subcategoryPopup = document.getElementById("subcategoryPopup");
      const popupTitle = document.getElementById("popupTitle");
      const subcategoryForm = document.getElementById("subcategoryForm");
      const subcategoryCategorySelect = document.getElementById("subcategoryCategory");
      const subcategoryNameInput = document.getElementById("subcategoryName");
      const productNameInput = document.getElementById("productName");
      const priceInput = document.getElementById("price");
      const quantityInput = document.getElementById("quantity");
      const subcategoryDescInput = document.getElementById("subcategoryDesc");
      const subcategoryImg = document.getElementById("subcategoryImg");
      const subcategoryPhotoInput = document.getElementById("subcategoryPhotoInput");
      const changeSubcategoryPhotoBtn = document.getElementById("changeSubcategoryPhoto");
      const searchInput = document.getElementById("searchInput");
      const sortSelect = document.getElementById("sortSelect");
      const applyFiltersBtn = document.getElementById("applyFiltersBtn");
      const closePopupBtn = document.getElementById("closePopupBtn");
      const categorySelect = document.getElementById("categorySelect");
      let editingIndex = -1;

      const defaultImage = "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?auto=format&fit=crop&w=150&q=80";

      function deduplicateCategories(cats) {
        const seen = new Map();
        cats.forEach((cat) => {
          const nameLower = (cat.name || "").trim().toLowerCase();
          if (nameLower && !seen.has(nameLower)) {
            seen.set(nameLower, { ...cat, name: cat.name.trim() });
          } else if (nameLower) {
            seen.set(nameLower, { ...cat, name: cat.name.trim() });
          }
        });
        return Array.from(seen.values());
      }

      categories = deduplicateCategories(categories);

      function populateCategoryDropdowns() {
        subcategoryCategorySelect.innerHTML = "";
        categorySelect.innerHTML = '<option value="all">Category: All Categories</option>';

        const uniqueCategories = deduplicateCategories(categories);
        uniqueCategories.forEach((cat) => {
          const option1 = document.createElement("option");
          option1.value = (cat.name || "").trim().toLowerCase();
          option1.textContent = cat.name || "";
          subcategoryCategorySelect.appendChild(option1);

          const option2 = document.createElement("option");
          option2.value = (cat.name || "").trim().toLowerCase();
          option2.textContent = cat.name || "";
          categorySelect.appendChild(option2);
        });

        subcategoryImg.src =
          uniqueCategories.find((cat) => (cat.name || "").trim().toLowerCase() === (subcategoryCategorySelect.value || "").trim().toLowerCase())?.image ||
          defaultImage;
      }

      populateCategoryDropdowns();

      window.addEventListener("storage", (e) => {
        if (e.key === "categories") {
          categories = JSON.parse(e.newValue) || [];
          categories = deduplicateCategories(categories);
          populateCategoryDropdowns();
          renderSubcategories(searchInput.value, categorySelect.value);
        }
      });

      function renderSubcategories(searchFilter = "", filterCategory = "all") {
        subcategoryTableBody.innerHTML = "";
        let filteredSubcategories = subcategories.filter((sub) => {
          const matchesSearch =
            (sub.productName || "").toLowerCase().includes(searchFilter.toLowerCase()) ||
            ((sub.category || "").trim().toLowerCase().includes(searchFilter.toLowerCase())) ||
            (sub.desc || "").toLowerCase().includes(searchFilter.toLowerCase());
          const matchesCategory = filterCategory === "all" || 
            ((sub.category || "").trim().toLowerCase() === (filterCategory || "").trim().toLowerCase());
          return matchesSearch && matchesCategory;
        });

        switch (sortSelect.value) {
          case "name-asc":
            filteredSubcategories.sort((a, b) => 
              (a.productName || "").localeCompare(b.productName || ""));
            break;
          case "name-desc":
            filteredSubcategories.sort((a, b) => 
              (b.productName || "").localeCompare(a.productName || ""));
            break;
          case "price-asc":
            filteredSubcategories.sort((a, b) => 
              (a.price || 0) - (b.price || 0));
            break;
          case "price-desc":
            filteredSubcategories.sort((a, b) => 
              (b.price || 0) - (a.price || 0));
            break;
          case "newest":
            filteredSubcategories.sort((a, b) => 
              new Date(b.createdAt || "1970-01-01") - new Date(a.createdAt || "1970-01-01"));
            break;
          case "oldest":
            filteredSubcategories.sort((a, b) => 
              new Date(a.createdAt || "1970-01-01") - new Date(b.createdAt || "1970-01-01"));
            break;
        }

        filteredSubcategories.forEach((sub, index) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${index + 1}</td>
            <td><img src="${sub.image || defaultImage}" alt="${sub.productName || ''}" style="width: 40px; height: 40px; object-fit: cover;"></td>
            <td>${sub.category || ''}</td>
            <td>${sub.subcategory || ''}</td>
            <td>${sub.productName || ''}</td>
            <td>$${sub.price ? sub.price.toFixed(2) : '0.00'}</td>
            <td>${sub.quantity || 0}</td>
            <td>${sub.desc || ''}</td>
            <td>
              <button class="edit-subcategory" data-index="${index}">Edit</button>
              <button class="delete-subcategory" data-index="${index}">Delete</button>
            </td>
          `;
          subcategoryTableBody.appendChild(row);
        });
        totalSubcategories.textContent = `Total: ${filteredSubcategories.length}`;
      }

      renderSubcategories();

      addNewSubBtn.addEventListener("click", () => {
        popupTitle.textContent = "Add Subcategory";
        const uniqueCategories = deduplicateCategories(categories);
        subcategoryCategorySelect.value = uniqueCategories[0]?.name.trim().toLowerCase() || "vegetables";
        subcategoryNameInput.value = "";
        productNameInput.value = "";
        priceInput.value = "";
        quantityInput.value = "";
        subcategoryDescInput.value = "";
        subcategoryImg.src = defaultImage;
        editingIndex = -1;
        subcategoryPopup.style.display = "flex";
      });

      subcategoryCategorySelect.addEventListener("change", () => {
        const uniqueCategories = deduplicateCategories(categories);
        subcategoryImg.src =
          uniqueCategories.find((cat) => (cat.name || "").trim().toLowerCase() === (subcategoryCategorySelect.value || "").trim().toLowerCase())?.image ||
          defaultImage;
      });

      changeSubcategoryPhotoBtn.addEventListener("click", () => {
        subcategoryPhotoInput.click();
      });

      subcategoryPhotoInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (event) => {
            subcategoryImg.src = event.target.result;
          };
          reader.readAsDataURL(file);
        }
      });

      subcategoryForm.addEventListener("submit", (e) => {
        e.preventDefault();
        if (!subcategoryCategorySelect.value || !subcategoryNameInput.value || !productNameInput.value || !priceInput.value || !quantityInput.value || !subcategoryDescInput.value) {
          alert("Please fill all fields.");
          return;
        }
        const subcategory = {
          category: subcategoryCategorySelect.value,
          subcategory: subcategoryNameInput.value,
          productName: productNameInput.value,
          price: parseFloat(priceInput.value),
          quantity: parseInt(quantityInput.value),
          desc: subcategoryDescInput.value,
          image: subcategoryImg.src,
          createdAt: editingIndex >= 0 ? subcategories[editingIndex].createdAt || new Date().toISOString() : new Date().toISOString()
        };
        if (editingIndex >= 0) {
          subcategories[editingIndex] = subcategory;
        } else {
          subcategories.push(subcategory);
        }
        localStorage.setItem("subcategories", JSON.stringify(subcategories));
        renderSubcategories(searchInput.value, categorySelect.value);
        subcategoryPopup.style.display = "none";
      });

      document.querySelectorAll(".cancel-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          subcategoryPopup.style.display = "none";
          profilePopup.style.display = "none";
        });
      });

      closePopupBtn.addEventListener("click", () => {
        subcategoryPopup.style.display = "none";
      });

      subcategoryTableBody.addEventListener("click", (e) => {
        if (e.target.classList.contains("edit-subcategory")) {
          editingIndex = parseInt(e.target.getAttribute("data-index"));
          const sub = subcategories[editingIndex];
          popupTitle.textContent = "Edit Subcategory";
          subcategoryCategorySelect.value = (sub.category || "").trim().toLowerCase();
          subcategoryNameInput.value = sub.subcategory;
          productNameInput.value = sub.productName;
          priceInput.value = sub.price;
          quantityInput.value = sub.quantity;
          subcategoryDescInput.value = sub.desc;
          subcategoryImg.src = sub.image || defaultImage;
          subcategoryPopup.style.display = "flex";
        } else if (e.target.classList.contains("delete-subcategory")) {
          const index = parseInt(e.target.getAttribute("data-index"));
          if (confirm("Are you sure you want to delete this subcategory?")) {
            subcategories.splice(index, 1);
            localStorage.setItem("subcategories", JSON.stringify(subcategories));
            renderSubcategories(searchInput.value, categorySelect.value);
          }
        }
      });

      searchInput.addEventListener("input", (e) => {
        renderSubcategories(e.target.value, categorySelect.value);
      });

      sortSelect.addEventListener("change", () => {
        renderSubcategories(searchInput.value, categorySelect.value);
      });

      applyFiltersBtn.addEventListener("click", () => {
        renderSubcategories(searchInput.value, categorySelect.value);
      });

      // Import functionality
      const importModal = document.getElementById("importModal");
      const csvFileInput = document.getElementById("csvFile");
      const closeImportModal = document.querySelector("#importModal .close");
      const importBtn = document.getElementById("importSubcategoriesBtn");
      const headerCheckbox = importModal.querySelector("#containsHeaders");

      document.querySelectorAll(".btn-import").forEach((btn) => {
        btn.addEventListener("click", () => {
          importModal.style.display = "flex";
        });
      });

      closeImportModal.addEventListener("click", () => {
        importModal.style.display = "none";
        csvFileInput.value = "";
      });

      importBtn.addEventListener("click", () => {
        const file = csvFileInput.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e) => {
            const text = e.target.result;
            const rows = text.split("\n");
            const hasHeaders = headerCheckbox.checked;
            const startIndex = hasHeaders ? 1 : 0;

            rows.slice(startIndex).forEach((row) => {
              const [category, subcategory, productName, price, desc, image, quantity, createdAt] = row
                .split(",")
                .map((item) => item.trim());
              if (category && subcategory && productName && price && desc) {
                const validCreatedAt = createdAt && !isNaN(new Date(createdAt)) 
                  ? createdAt 
                  : new Date().toISOString();
                const newSubcategory = {
                  category: category.trim(),
                  subcategory: subcategory.trim(),
                  productName: productName.trim(),
                  price: parseFloat(price.trim()),
                  quantity: quantity ? parseInt(quantity.trim()) : 0,
                  desc: desc.trim(),
                  image: image ? image.trim() : defaultImage,
                  createdAt: validCreatedAt
                };
                const existingIndex = subcategories.findIndex(
                  (sub) =>
                    sub.productName === newSubcategory.productName &&
                    (sub.category || "").trim().toLowerCase() === (newSubcategory.category || "").trim().toLowerCase()
                );
                if (existingIndex >= 0) {
                  subcategories[existingIndex] = newSubcategory;
                } else {
                  subcategories.push(newSubcategory);
                }
              }
            });
            localStorage.setItem("subcategories", JSON.stringify(subcategories));
            renderSubcategories(searchInput.value, categorySelect.value);
            importModal.style.display = "none";
            csvFileInput.value = "";
          };
          reader.readAsText(file);
        } else {
          alert("Please select a CSV file.");
        }
      });

      window.addEventListener("click", (e) => {
        if (e.target === importModal) {
          importModal.style.display = "none";
          csvFileInput.value = "";
        }
      });

      // Export functionality
      const exportModal = document.getElementById("exportModal");
      const closeExportModal = document.querySelector("#exportModal .close");
      const downloadCsvBtn = document.getElementById("downloadCsvBtn");

      document.querySelectorAll(".btn-export").forEach((btn) => {
        btn.addEventListener("click", () => {
          exportModal.style.display = "flex";
        });
      });

      closeExportModal.addEventListener("click", () => {
        exportModal.style.display = "none";
      });

      window.addEventListener("click", (e) => {
        if (e.target === exportModal) {
          exportModal.style.display = "none";
        }
      });

      downloadCsvBtn.addEventListener("click", () => {
        const csv = [
          "Category,Subcategory,Product Name,Price,Description,Image,Quantity,CreatedAt",
          ...subcategories.map((sub) =>
            `${sub.category},${sub.subcategory},${sub.productName},${sub.price},${sub.desc},${sub.image},${sub.quantity},${sub.createdAt || ''}`
          ),
        ].join("\n");
        const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "subcategories.csv";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
        exportModal.style.display = "none";
      });
    </script>
  </body>
</html>
