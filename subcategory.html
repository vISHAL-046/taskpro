<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Subcategory Manager</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-RvQxD1xX9Z+nq87shL6oI6+3w+OkMDWimk3L0m3vT/cslS+9f5TjL44z4Qjwhh69f7gD8mKjIfd1z+7klXJpHg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="subcategory.css" />
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="nav-profile.css" />
  </head>
  <body>
    <!-- NAVBAR -->
    <header class="navbar">
      <div class="nav-inner">
        <div class="brand">
          <div class="logo">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="28"
              height="28"
              fill="white"
              class="bi bi-check2-square"
              viewBox="0 0 16 16"
            >
              <path
                d="M3 14.5A1.5 1.5 0 0 1 1.5 13V3A1.5 1.5 0 0 1 3 1.5h8a.5.5 0 0 1 0 1H3a.5.5 0 0 0-.5.5v10a.5.5 0 0 0 .5.5h10a.5.5 0 0 0 .5-.5V8a.5.5 0 0 1 1 0v5a1.5 1.5 0 0 1-1.5 1.5z"
              />
              <path
                d="m8.354 10.354 7-7a.5.5 0 0 0-.708-.708L8 9.293 5.354 6.646a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0"
              />
            </svg>
          </div>
          <span class="brand-name">TaskPro</span>
        </div>
        <div class="nav-actions">
          <a href="dashboard.html" class="dashboard-pill">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              fill="white"
              class="bi bi-house"
              viewBox="0 0 16 16"
            >
              <path
                d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5z"
              />
            </svg>
            <span class="dashboard-text">Dashboard</span>
          </a>
          <div class="profile" id="profile">
            <div id="profileIcon" class="profile-trigger">
              <img
                src="download.jpeg"
                alt="Profile"
                style="width: 34px; height: 34px; border-radius: 50%"
              />
            </div>
            <div id="profileDropdown" class="profile-dropdown">
              <ul>
                <li><a href="#" id="editProfileLink">Edit</a></li>
                <li><a href="#" id="settingsLink">Settings</a></li>
                <li><a href="#" id="logoutLink">Logout</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Subcategory Manager Content -->
    <main class="container">
      <div class="subcategory-banner">
        <div class="subcategory-content">
          <div class="subcategory-title">
            <div class="subcategory-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="34"
                height="34"
                fill="white"
                viewBox="0 0 24 24"
              >
                <path
                  d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"
                  stroke="currentColor"
                  stroke-width="2"
                  fill="none"
                />
              </svg>
            </div>
            <h1>Manage Subcategories</h1>
          </div>
          <p>Organize your products into categories and subcategories</p>
        </div>
      </div>
      <div class="stats-container">
        <div class="card">
          <h3>Statistics</h3>
          <div class="total-box">Total: 0</div>
          <div class="buttons">
            <button class="btn btn-import">
              <i class="fas fa-upload"></i> Import
            </button>
            <button class="btn btn-export">
              <i class="fas fa-download"></i> Export
            </button>
          </div>
        </div>
      
      </div>
      <!--search-->
  <div class="search-stats-wrapper">
  <div class="search-container">
    <div class="search-bar">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
      </svg>
      <span class="search">Search Subcategories</span>
      <input
        type="text"
        id="searchInput"
        placeholder="Search by name, category, or description..."
      />
    </div>
  </div>
  <div class="stats-container">
    <div class="card">
      <h3>Statistics</h3>
      <div class="total-box">Total: 0</div>
      <div class="buttons">
        <button class="btn btn-import">
          <i class="fas fa-upload"></i> Import
        </button>
        <button class="btn btn-export">
          <i class="fas fa-download"></i> Export
        </button>
      </div>
    </div>
  </div>
</div>  
  <div class="filter-sort-container">
  <div class="filter-sort-header">
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-funnel" viewBox="0 0 16 16">
      <path d="M1.5 1.5A.5.5 0 0 1 2 1h12a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.128.334L10 8.692V13.5a.5.5 0 0 1-.342.474l-3 1A.5.5 0 0 1 6 14.5V8.692L1.628 3.834A.5.5 0 0 1 1.5 3.5zm1 .5v1.308l4.372 4.858A.5.5 0 0 1 7 8.5v5.306l2-.666V8.5a.5.5 0 0 1 .128-.334L13.5 3.308V2z"/>
    </svg>
    <span class="filter-sort-label">Filter & Sort</span>
  </div>
  <div class="filter-sort-content">
    <div class="filter-sort-options">
      <select class="pill category-select" style="border: 1px solid #CED4DA;">
        <option value="all">Category: All Categories</option>
        <option value="electronics">Electronics</option>
        <option value="furniture">Furniture</option>
        <option>Men</option>
        <option>Women</option>
        <option>Gym</option>
        <option>Vegetables</option>
      </select>
      <select class="pill sort-select" style="border: 1px solid #CED4DA;">
        <option value="default">Sort by: Default</option>
        <option value="name">Name</option>
        <option value="price">Price</option>
      </select>
    </div>
    <div class="actions">
      <button class="btn apply">‚úî Apply</button>
      <button id="addNewSubBtnFilter" class="btn add-new-btn">‚ûï Add New</button>
    </div>
  </div>
</div>
      
      <table class="category-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>IMAGE</th>
            <th>CATEGORY</th>
            <th>SUBCATEGORY</th>
            <th>PRODUCT NAME</th>
            <th>PRICE</th>
            <th>QUANTITY</th>
            <th>DESCRIPTION</th>
            <th>ACTIONS</th>
          </tr>
        </thead>
        <tbody id="subcategoryTableBody">
          <!-- Subcategories will be inserted here -->
        </tbody>
      </table>
    </main>

    <!-- Add/Edit Subcategory Popup -->
    <div class="profile-popup" id="subcategoryPopup">
      <div class="popup-inner">
        <div class="popup-header">
          <h2 id="popupTitle">Add Subcategory</h2>
          <button class="close-btn" id="closePopupBtn">&times;</button>
        </div>
        <div class="image-container">
          <img
            id="subcategoryImg"
            alt="Subcategory Image"
            style="width: 150px; height: 150px; object-fit: cover"
          />
          <input
            type="file"
            id="subcategoryPhotoInput"
            accept="image/*"
            style="display: none"
          />
          <button id="changeSubcategoryPhoto" class="image-btn">
            Change Image
          </button>
        </div>
        <form id="subcategoryForm" class="ecommerce-form">
          <div class="form-group">
            <label>Category</label>
            <select id="subcategoryCategory" required>
              <!-- Categories will be populated here -->
            </select>
          </div>
          <div class="form-group">
            <label>Subcategory</label>
            <input
              type="text"
              id="subcategoryName"
              required
              placeholder="e.g., Table Fan"
            />
          </div>
          <div class="form-group">
            <label>Product Name</label>
            <input
              type="text"
              id="productName"
              required
              placeholder="e.g., Premium Table Fan"
            />
          </div>
          <div class="form-group">
            <label>Price ($)</label>
            <input
              type="number"
              id="price"
              step="0.01"
              required
              placeholder="e.g., 49.99"
            />
          </div>
          <div class="form-group">
            <label>Quantity</label>
            <input
              type="number"
              id="quantity"
              required
              placeholder="e.g., 50"
            />
          </div>
          <div class="form-group">
            <label>Description</label>
            <input
              type="text"
              id="subcategoryDesc"
              required
              placeholder="e.g., High-quality table fan"
            />
          </div>
          <div class="form-actions">
            <button type="submit" class="save-btn">Save</button>
            <button type="button" class="cancel-btn">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Edit Profile Popup -->
    <div class="profile-popup" id="profilePopup">
      <div class="popup-inner">
        <div class="popup-header">
          <h2>Edit Profile</h2>
          <button class="close-btn" id="closeProfilePopupBtn">&times;</button>
        </div>
        <div class="image-container">
          <img id="profileImg" alt="Profile" />
          <input
            type="file"
            id="photoInput"
            accept="image/*"
            style="display: none"
          />
          <button id="changePhoto" class="image-btn">Change Photo</button>
        </div>
        <form id="profileForm" class="ecommerce-form">
          <div class="form-group">
            <label>Username</label>
            <input type="text" id="username" value="owner" />
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="email" value="owner@signaltone.com" />
          </div>
          <div class="form-actions">
            <button type="submit" class="save-btn">Save Changes</button>
            <button type="button" class="cancel-btn">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Import Modal -->
    <div id="importModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>üìÇ Import Categories from CSV</h2>

        <label for="csvFile">CSV File</label>
        <input type="file" id="csvFile" accept=".csv" />

        <p class="hint">
          CSV format: <code>name,description,image_path</code> (optional).
          <a href="#" id="downloadTemplate">Download template</a>
        </p>

        <div class="checkbox-row">
          <input type="checkbox" id="containsHeaders" checked />
          <label for="containsHeaders">First row contains headers</label>
        </div>

        <div class="warning">
          ‚ö†Ô∏è Existing categories with the same name will be updated.<br />
          New categories will be added with continuous IDs.
        </div>

        <div class="modal-actions">
          <button class="btn btn-cancel">Cancel</button>
          <button class="btn btn-blue">‚¨Ü Import Categories</button>
        </div>
      </div>
    </div>

    <!-- Export Modal -->
    <div id="exportModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Export categories to CSV</h2>
        <p>Click below to export all categories as a CSV file.</p>
        <button class="btn btn-blue" id="downloadCsvBtn">Download CSV</button>
      </div>
    </div>


    <footer class="footer">
      <small>¬©Ô∏è 2025 TaskPro ‚Äî Dashboard prototype (Last updated: 07:32 PM IST, Tuesday, September 16, 2025)</small>
    </footer>

    <script>
      // Profile functionality
      const savedUsername = localStorage.getItem("username") || "owner";
      const savedEmail = localStorage.getItem("email") || "owner@signaltone.com";
      const savedProfileImg = localStorage.getItem("profileImg") || "download.jpeg";

      document.getElementById("username").value = savedUsername;
      document.getElementById("email").value = savedEmail;
      const profileIcon = document.getElementById("profileIcon");
      const profileImg = document.getElementById("profileImg");
      const profileTrigger = document.querySelector(".profile-trigger");
      const profilePopup = document.getElementById("profilePopup");
      const profileForm = document.getElementById("profileForm");
      const usernameInput = document.getElementById("username");
      const emailInput = document.getElementById("email");
      const photoInput = document.getElementById("photoInput");
      const changePhotoBtn = document.getElementById("changePhoto");
      const closeProfilePopupBtn = document.getElementById("closeProfilePopupBtn");
      const profileDropdown = document.getElementById("profileDropdown");
      const editProfileLink = document.getElementById("editProfileLink");
      const settingsLink = document.getElementById("settingsLink");
      const logoutLink = document.getElementById("logoutLink");

      profileImg.src = savedProfileImg;
      profileIcon.innerHTML = `<img src="${savedProfileImg}" alt="Profile" style="width: 34px; height: 34px; border-radius: 50%;">`;

      profileTrigger.addEventListener("click", (e) => {
        e.preventDefault();
        profileDropdown.style.display = profileDropdown.style.display === "block" ? "none" : "block";
      });

      editProfileLink.addEventListener("click", (e) => {
        e.preventDefault();
        profileDropdown.style.display = "none";
        profilePopup.style.display = "flex";
      });

      settingsLink.addEventListener("click", (e) => {
        e.preventDefault();
        profileDropdown.style.display = "none";
        alert("Settings page is not implemented yet.");
      });

      logoutLink.addEventListener("click", (e) => {
        e.preventDefault();
        profileDropdown.style.display = "none";
        if (confirm("Are you sure you want to logout?")) {
          localStorage.removeItem("username");
          localStorage.removeItem("email");
          localStorage.removeItem("profileImg");
          window.location.href = "index.html";
        }
      });

      changePhotoBtn.addEventListener("click", () => {
        photoInput.click();
      });

      photoInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (event) => {
            profileImg.src = event.target.result;
            profileIcon.innerHTML = `<img src="${event.target.result}" alt="Profile" style="width: 34px; height: 34px; border-radius: 50%;">`;
          };
          reader.readAsDataURL(file);
        }
      });

      profileForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const username = usernameInput.value;
        const email = emailInput.value;
        const profileImgSrc = profileImg.src;
        localStorage.setItem("username", username);
        localStorage.setItem("email", email);
        localStorage.setItem("profileImg", profileImgSrc);
        profileIcon.innerHTML = `<img src="${profileImgSrc}" alt="Profile" style="width: 34px; height: 34px; border-radius: 50%;">`;
        profilePopup.style.display = "none";
      });

      document.querySelector("#profilePopup .cancel-btn").addEventListener("click", () => {
        profilePopup.style.display = "none";
        usernameInput.value = localStorage.getItem("username") || "owner";
        emailInput.value = localStorage.getItem("email") || "owner@signaltone.com";
        profileImg.src = localStorage.getItem("profileImg") || "https://via.placeholder.com/100";
        profileIcon.innerHTML = `<img src="${profileImg.src}" alt="Profile" style="width: 34px; height: 34px; border-radius: 50%;">`;
      });

      closeProfilePopupBtn.addEventListener("click", () => {
        profilePopup.style.display = "none";
      });

      // Subcategory functionality
      let categories = JSON.parse(localStorage.getItem("categories")) || [
        { name: "Electronics", image: "https://via.placeholder.com/150" },
        { name: "Furniture", image: "https://via.placeholder.com/150" },
      ];
      let subcategories = JSON.parse(localStorage.getItem("subcategories")) || [];
      const subcategoryTableBody = document.getElementById("subcategoryTableBody");
      const addNewSubBtn = document.getElementById("addNewSubBtnFilter"); // Updated to match HTML ID
      const subcategoryPopup = document.getElementById("subcategoryPopup");
      const popupTitle = document.getElementById("popupTitle");
      const subcategoryForm = document.getElementById("subcategoryForm");
      const subcategoryCategorySelect = document.getElementById("subcategoryCategory");
      const subcategoryNameInput = document.getElementById("subcategoryName");
      const productNameInput = document.getElementById("productName");
      const priceInput = document.getElementById("price");
      const quantityInput = document.getElementById("quantity");
      const subcategoryDescInput = document.getElementById("subcategoryDesc");
      const subcategoryImg = document.getElementById("subcategoryImg");
      const subcategoryPhotoInput = document.getElementById("subcategoryPhotoInput");
      const changeSubcategoryPhotoBtn = document.getElementById("changeSubcategoryPhoto");
      const searchInput = document.getElementById("searchInput");
      const closePopupBtn = document.getElementById("closePopupBtn");
      let editingIndex = -1;

      // Initialize categories dropdown
      categories.forEach((cat) => {
        const option = document.createElement("option");
        option.value = cat.name;
        option.textContent = cat.name;
        subcategoryCategorySelect.appendChild(option);
      });

      const defaultImage = "https://images.unsplash.com/photo-1600585152280-be6161a56a0c?auto=format&fit=crop&w=150&q=80";

      function renderSubcategories(filter = "") {
        subcategoryTableBody.innerHTML = "";
        const filteredSubcategories = subcategories.filter((sub) =>
          sub.productName.toLowerCase().includes(filter.toLowerCase()) ||
          sub.category.toLowerCase().includes(filter.toLowerCase()) ||
          sub.desc.toLowerCase().includes(filter.toLowerCase())
        );
        filteredSubcategories.forEach((sub, index) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${index + 1}</td>
            <td><img src="${sub.image || defaultImage}" alt="${sub.productName}" style="width: 50px; height: 50px; object-fit: cover;"></td>
            <td>${sub.category}</td>
            <td>${sub.subcategory}</td>
            <td>${sub.productName}</td>
            <td>$${sub.price.toFixed(2)}</td>
            <td>${sub.quantity}</td>
            <td>${sub.desc}</td>
            <td>
              <button class="edit-subcategory" data-index="${index}">Edit</button>
              <button class="delete-subcategory" data-index="${index}">Delete</button>
            </td>
          `;
          subcategoryTableBody.appendChild(row);
        });
      }

      renderSubcategories();

      addNewSubBtn.addEventListener("click", () => {
        if (!addNewSubBtn) {
          console.error("Add New button not found!");
          return;
        }
        popupTitle.textContent = "Add Subcategory";
        subcategoryCategorySelect.value = categories[0]?.name || "";
        subcategoryNameInput.value = "";
        productNameInput.value = "";
        priceInput.value = "";
        quantityInput.value = "";
        subcategoryDescInput.value = "";
        subcategoryImg.src =
          categories.find((cat) => cat.name === subcategoryCategorySelect.value)
            ?.image || defaultImage;
        editingIndex = -1;
        subcategoryPopup.style.display = "flex";
      });

      subcategoryCategorySelect.addEventListener("change", () => {
        subcategoryImg.src =
          categories.find((cat) => cat.name === subcategoryCategorySelect.value)
            ?.image || defaultImage;
      });

      changeSubcategoryPhotoBtn.addEventListener("click", () => {
        subcategoryPhotoInput.click();
      });

      subcategoryPhotoInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (event) => {
            subcategoryImg.src = event.target.result;
          };
          reader.readAsDataURL(file);
        }
      });

      subcategoryForm.addEventListener("submit", (e) => {
        e.preventDefault();
        if (!subcategoryCategorySelect.value || !subcategoryNameInput.value || !productNameInput.value || !priceInput.value || !quantityInput.value || !subcategoryDescInput.value) {
          alert("Please fill all fields.");
          return;
        }
        const subcategory = {
          category: subcategoryCategorySelect.value,
          subcategory: subcategoryNameInput.value,
          productName: productNameInput.value,
          price: parseFloat(priceInput.value),
          quantity: parseInt(quantityInput.value),
          desc: subcategoryDescInput.value,
          image: subcategoryImg.src,
        };
        if (editingIndex >= 0) {
          subcategories[editingIndex] = subcategory;
        } else {
          subcategories.push(subcategory);
        }
        localStorage.setItem("subcategories", JSON.stringify(subcategories));
        renderSubcategories(searchInput.value);
        subcategoryPopup.style.display = "none";
        if (editingIndex === -1) {
          subcategoryCategorySelect.value = categories[0]?.name || "";
          subcategoryNameInput.value = "";
          productNameInput.value = "";
          priceInput.value = "";
          quantityInput.value = "";
          subcategoryDescInput.value = "";
          subcategoryImg.src =
            categories.find((cat) => cat.name === subcategoryCategorySelect.value)
              ?.image || defaultImage;
        } else {
          const sub = subcategories[editingIndex];
          subcategoryCategorySelect.value = sub.category;
          subcategoryNameInput.value = sub.subcategory;
          productNameInput.value = sub.productName;
          priceInput.value = sub.price;
          quantityInput.value = sub.quantity;
          subcategoryDescInput.value = sub.desc;
          subcategoryImg.src = sub.image || defaultImage;
        }
      });

      document.querySelectorAll(".cancel-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          subcategoryPopup.style.display = "none";
          profilePopup.style.display = "none";
          if (editingIndex >= 0) {
            const sub = subcategories[editingIndex];
            subcategoryCategorySelect.value = sub.category;
            subcategoryNameInput.value = sub.subcategory;
            productNameInput.value = sub.productName;
            priceInput.value = sub.price;
            quantityInput.value = sub.quantity;
            subcategoryDescInput.value = sub.desc;
            subcategoryImg.src = sub.image || defaultImage;
          } else {
            subcategoryCategorySelect.value = categories[0]?.name || "";
            subcategoryNameInput.value = "";
            productNameInput.value = "";
            priceInput.value = "";
            quantityInput.value = "";
            subcategoryDescInput.value = "";
            subcategoryImg.src =
              categories.find((cat) => cat.name === subcategoryCategorySelect.value)
                ?.image || defaultImage;
          }
        });
      });

      closePopupBtn.addEventListener("click", () => {
        subcategoryPopup.style.display = "none";
        if (editingIndex >= 0) {
          const sub = subcategories[editingIndex];
          subcategoryCategorySelect.value = sub.category;
          subcategoryNameInput.value = sub.subcategory;
          productNameInput.value = sub.productName;
          priceInput.value = sub.price;
          quantityInput.value = sub.quantity;
          subcategoryDescInput.value = sub.desc;
          subcategoryImg.src = sub.image || defaultImage;
        } else {
          subcategoryCategorySelect.value = categories[0]?.name || "";
          subcategoryNameInput.value = "";
          productNameInput.value = "";
          priceInput.value = "";
          quantityInput.value = "";
          subcategoryDescInput.value = "";
          subcategoryImg.src =
            categories.find((cat) => cat.name === subcategoryCategorySelect.value)
              ?.image || defaultImage;
        }
      });

      subcategoryTableBody.addEventListener("click", (e) => {
        if (e.target.classList.contains("edit-subcategory")) {
          editingIndex = parseInt(e.target.getAttribute("data-index"));
          const sub = subcategories[editingIndex];
          popupTitle.textContent = "Edit Subcategory";
          subcategoryCategorySelect.value = sub.category;
          subcategoryNameInput.value = sub.subcategory;
          productNameInput.value = sub.productName;
          priceInput.value = sub.price;
          quantityInput.value = sub.quantity;
          subcategoryDescInput.value = sub.desc;
          subcategoryImg.src = sub.image || defaultImage;
          subcategoryPopup.style.display = "flex";
        } else if (e.target.classList.contains("delete-subcategory")) {
          const index = parseInt(e.target.getAttribute("data-index"));
          if (confirm("Are you sure you want to delete this subcategory?")) {
            subcategories.splice(index, 1);
            localStorage.setItem("subcategories", JSON.stringify(subcategories));
            renderSubcategories(searchInput.value);
          }
        }
      });

      searchInput.addEventListener("input", (e) => {
        renderSubcategories(e.target.value);
      });

      // Import functionality
      const importModal = document.getElementById("importModal");
      const csvFileInput = document.getElementById("csvFile");
      const closeImportModal = document.querySelector("#importModal .close");
      const importBtn = document.querySelector(".import-btn");
      const headerCheckbox = importModal.querySelector(".checkbox input");

      document.querySelectorAll(".btn-import").forEach((btn) => {
        btn.addEventListener("click", () => {
          importModal.style.display = "flex";
        });
      });

      closeImportModal.addEventListener("click", () => {
        importModal.style.display = "none";
        csvFileInput.value = ""; // Reset file input on close
      });

      importBtn.addEventListener("click", () => {
        const file = csvFileInput.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e) => {
            const text = e.target.result;
            const rows = text.split("\n");
            const hasHeaders = headerCheckbox.checked;
            const startIndex = hasHeaders ? 1 : 0;

            rows.slice(startIndex).forEach((row) => {
              const [category, subcategory, productName, price, desc, image] = row
                .split(",")
                .map((item) => item.trim());
              if (category && subcategory && productName && price && desc) {
                const newSubcategory = {
                  category: category.trim(),
                  subcategory: subcategory.trim(),
                  productName: productName.trim(),
                  price: parseFloat(price.trim()),
                  quantity: 0, // Default quantity
                  desc: desc.trim(),
                  image: image ? image.trim() : defaultImage,
                };
                const existingIndex = subcategories.findIndex(
                  (sub) =>
                    sub.productName === newSubcategory.productName &&
                    sub.category === newSubcategory.category
                );
                if (existingIndex >= 0) {
                  subcategories[existingIndex] = newSubcategory;
                } else {
                  subcategories.push(newSubcategory);
                }
              } else {
                console.error("Invalid row data:", row);
              }
            });
            localStorage.setItem("subcategories", JSON.stringify(subcategories));
            renderSubcategories(searchInput.value);
            importModal.style.display = "none";
            csvFileInput.value = ""; // Reset file input
          };
          reader.readAsText(file);
        } else {
          alert("Please select a CSV file.");
        }
      });

      // Close modal when clicking outside
      window.addEventListener("click", (e) => {
        if (e.target === importModal) {
          importModal.style.display = "none";
          csvFileInput.value = ""; // Reset file input on outside click
        }
      });

      // Export functionality
      document.querySelector(".btn-export").addEventListener("click", () => {
        const csv = [
          "Category,Subcategory,Product Name,Price,Description,Image",
          ...subcategories.map((sub) =>
            `${sub.category},${sub.subcategory},${sub.productName},${sub.price},${sub.desc},${sub.image}`
          ),
        ].join("\n");
        const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "subcategories.csv";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
      });
    </script>
  </body>
</html>