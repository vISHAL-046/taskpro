<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Category Manager</title>
    <link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <link rel="stylesheet" href="category.css" />
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="nav-profile.css" />
  </head>
  <body>
    <!-- NAVBAR -->
    <header class="navbar">
      <div class="nav-inner">
        <div class="brand">
          <div class="logo">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="28"
              height="28"
              fill="white"
              class="bi bi-check2-square"
              viewBox="0 0 16 16"
            >
              <path
                d="M3 14.5A1.5 1.5 0 0 1 1.5 13V3A1.5 1.5 0 0 1 3 1.5h8a.5.5 0 0 1 0 1H3a.5.5 0 0 0-.5.5v10a.5.5 0 0 0 .5.5h10a.5.5 0 0 0 .5-.5V8a.5.5 0 0 1 1 0v5a1.5 1.5 0 0 1-1.5 1.5z"
              />
              <path
                d="m8.354 10.354 7-7a.5.5 0 0 0-.708-.708L8 9.293 5.354 6.646a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0"
              />
            </svg>
          </div>
          <span class="brand-name">TaskPro</span>
        </div>
        <div class="nav-actions">
          <a href="dashboard.html" class="dashboard-pill">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              fill="white"
              class="bi bi-house"
              viewBox="0 0 16 16"
            >
              <path
                d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5z"
              />
            </svg>
            <span class="dashboard-text">Dashboard</span>
          </a>
          <div class="profile" id="profile">
            <div id="profileIcon" class="profile-trigger">
              <img
                src="download.jpeg"
                alt="Profile"
                style="width: 34px; height: 34px; border-radius: 50%"
              />
            </div>
            <div id="profileDropdown" class="profile-dropdown">
              <ul>
                <!-- <li><a href="#" id="editProfileLink">Edit</a></li> -->
                <li><a href="#" id="settingsLink">Settings</a></li>
                <li><a href="#" id="logoutLink">Logout</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Category Manager Content -->
    <main class="container">
    <section class="hero">
    <div class="header-content">
      <div class="title-wrapper">
        <div class="header-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-tags" viewBox="0 0 16 16">
            <path d="M3 2v4.586l7 7L14.586 9l-7-7zM2 2a1 1 0 0 1 1-1h4.586a1 1 0 0 1 .707.293l7 7a1 1 0 0 1 0 1.414l-4.586 4.586a1 1 0 0 1-1.414 0l-7-7A1 1 0 0 1 2 6.586z"/>
            <path d="M5.5 5a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1m0 1a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3M1 7.086a1 1 0 0 0 .293.707L8.75 15.25l-.043.043a1 1 0 0 1-1.414 0l-7-7A1 1 0 0 1 0 7.586V3a1 1 0 0 1 1-1z"/>
          </svg>
        </div>
        <span class="header-title">Category Manager</span>
      </div>
      <p class="header-subtitle">Organize and manage your product categories</p>
    </div>
    <div class="category-controls">
        <button id="categoryCount" class="btn btn-soft">0 Categories</button>
        <button id="addNewCatBtn" class="btn btn-soft btn-smokewhite">Add New</button>
        <select id="csvOptions" class="btn btn-soft">
          <option value=""></option>
          <option value="import">Import CSV</option>
          <option value="export">Export CSV</option>
        </select>
      </div>
  </section>
<br>
<br>
      <div class="search-sort">
    <div class="search">
      <label>Search Categories</label>
      <input
        type="text"
        id="searchInput"
        placeholder="Type at least 2 letters..."
      />
    </div>
    <div class="sort">
      <label>Sort Options</label>
      <select id="sortSelect">
        <option>Default Sorting</option>
        <option>Name(A-Z)</option>
        <option>Name(Z-A)</option>
        <option>Newest First</option>
        <option>Oldest First</option>
      </select>
    </div>
    <button class="apply-filters">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-funnel" viewBox="0 0 16 16">
        <path d="M1.5 1.5A.5.5 0 0 1 2 1h12a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.128.334L10 8.692V13.5a.5.5 0 0 1-.342.474l-3 1A.5.5 0 0 1 6 14.5V8.692L1.628 3.834A.5.5 0 0 1 1.5 3.5zm1 .5v1.308l4.372 4.858A.5.5 0 0 1 7 8.5v5.306l2-.666V8.5a.5.5 0 0 1 .128-.334L13.5 3.308V2z"/>
      </svg>
      Apply Filters
    </button>
  </div>


      <table class="category-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>IMG</th>
            <th>CATEGORY</th>
            <th>Description</th>
            <th>ACTIONS</th>
          </tr>
        </thead>
        <tbody id="categoryTableBody">
          <!-- Categories will be inserted here -->
        </tbody>
      </table>
    </main>

    <!-- Add/Edit Category Popup -->
    <div class="profile-popup" id="categoryPopup">
      <div class="popup-inner">
        <div class="popup-header">
          <h2 id="popupTitle">Add Category</h2>
          <button class="close-btn" id="closePopupBtn">&times;</button>
        </div>
        <div class="image-container">
          <img
            id="categoryImg"
            alt="Category Image"
            style="width: 150px; height: 150px; object-fit: cover"
          />
          <input
            type="file"
            id="categoryPhotoInput"
            accept="image/*"
            style="display: none"
          />
          <button id="changeCategoryPhoto" class="image-btn">
            
            Change Image
          </button>
        </div>
        <form id="categoryForm" class="ecommerce-form">
          <div class="form-group">
            <label>Category Name</label>
            <input
              type="text"
              id="categoryName"
              required
              placeholder="e.g., Electronics"
            />
          </div>
          <div class="form-group">
            <label>Description</label>
            <input
              type="text"
              id="categoryDesc"
              required
              placeholder="e.g., All electronic items"
            />
          </div>
          <div class="form-actions">
            <button type="submit" class="save-btn">Save</button>
            <button type="button" class="cancel-btn">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Edit Profile Popup -->
    <div class="profile-popup" id="profilePopup">
      <div class="popup-inner">
        <div class="popup-header">
          <h2>Edit Profile</h2>
          <button class="close-btn" id="closeProfilePopupBtn">&times;</button>
        </div>
        <div class="image-container">
          <img id="profileImg" alt="Profile" />
          <input
            type="file"
            id="photoInput"
            accept="image/*"
            style="display: none"
          />
          <button id="changePhoto" class="image-btn">Change Photo</button>
        </div>
        <form id="profileForm" class="ecommerce-form">
          <div class="form-group">
            <label>Username</label>
            <input type="text" id="username" value="owner" />
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="email" value="owner@signaltone.com" />
          </div>
          <div class="form-actions">
            <button type="submit" class="save-btn">Save Changes</button>
            <button type="button" class="cancel-btn">Cancel</button>
          </div>
        </form>
      </div>
    </div>

   
    <!-- Import Modal -->
    <div id="importModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>üìÇ Import Categories from CSV</h2>

        <label for="csvFile">CSV File</label>
        <input type="file" id="csvFile" accept=".csv" />

        <p class="hint">
          CSV format: <code>name,description,image_path</code> (optional).
          <a href="#" id="downloadTemplate">Download template</a>
        </p>

        <div class="checkbox-row">
          <input type="checkbox" id="containsHeaders" checked />
          <label for="containsHeaders">First row contains headers</label>
        </div>

        <div class="warning">
          ‚ö†Ô∏è Existing categories with the same name will be updated.<br />
          New categories will be added with continuous IDs.
        </div>

        <div class="modal-actions">
          <button class="btn btn-cancel">Cancel</button>
          <button class="btn btn-blue">‚¨Ü Import Categories</button>
        </div>
      </div>
    </div>

    <!-- Export Modal -->
    <div id="exportModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Export categories to CSV</h2>
        <p>Click below to export all categories as a CSV file.</p>
        <button class="btn btn-blue" id="downloadCsvBtn">Download CSV</button>
      </div>
    </div>

    <footer class="footer">
      <small>¬©Ô∏è <span id="year"></span> TaskPro ‚Äî Dashboard prototype</small>
    </footer>

    <script>
      document.getElementById("year").textContent = new Date().getFullYear();

      // Profile functionality
      const savedUsername = localStorage.getItem("username") || "owner";
      const savedEmail =
        localStorage.getItem("email") || "owner@signaltone.com";
      const savedProfileImg =
        localStorage.getItem("profileImg") || "download.jpeg";

      document.getElementById("username").value = savedUsername;
      document.getElementById("email").value = savedEmail;
      const profileIcon = document.getElementById("profileIcon");
      const profileImg = document.getElementById("profileImg");
      const profileTrigger = document.querySelector(".profile-trigger");
      const profilePopup = document.getElementById("profilePopup");
      const profileForm = document.getElementById("profileForm");
      const usernameInput = document.getElementById("username");
      const emailInput = document.getElementById("email");
      const photoInput = document.getElementById("photoInput");
      const changePhotoBtn = document.getElementById("changePhoto");
      const closeProfilePopupBtn = document.getElementById(
        "closeProfilePopupBtn"
      );
      const profileDropdown = document.getElementById("profileDropdown");
      const editProfileLink = document.getElementById("editProfileLink");
      const settingsLink = document.getElementById("settingsLink");
      const logoutLink = document.getElementById("logoutLink");

      profileImg.src = savedProfileImg;
      profileIcon.innerHTML = `<img src="${savedProfileImg}" alt="Profile" style="width: 34px; height: 34px; border-radius: 50%;">`;

      profileTrigger.addEventListener("click", (e) => {
        e.preventDefault();
        profileDropdown.style.display =
          profileDropdown.style.display === "block" ? "none" : "block";
      });

      settingsLink.addEventListener("click", (e) => {
        e.preventDefault();
        profileDropdown.style.display = "none";
        profilePopup.style.display = "flex";
      });

      // settingsLink.addEventListener("click", (e) => {
      //   e.preventDefault();
      //   profileDropdown.style.display = "none";
      //   alert("Settings page is not implemented yet.");
      // });

      logoutLink.addEventListener("click", (e) => {
        e.preventDefault();
        profileDropdown.style.display = "none";
        if (confirm("Are you sure you want to logout?")) {
          localStorage.removeItem("username");
          localStorage.removeItem("email");
          localStorage.removeItem("profileImg");
          window.location.href = "index.html";
        }
      });

      changePhotoBtn.addEventListener("click", () => {
        photoInput.click();
      });

      photoInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (event) => {
            profileImg.src = event.target.result;
            profileIcon.innerHTML = `<img src="${event.target.result}" alt="Profile" style="width: 34px; height: 34px; border-radius: 50%;">`;
          };
          reader.readAsDataURL(file);
        }
      });

      profileForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const username = usernameInput.value;
        const email = emailInput.value;
        const profileImgSrc = profileImg.src;
        localStorage.setItem("username", username);
        localStorage.setItem("email", email);
        localStorage.setItem("profileImg", profileImgSrc);
        profileIcon.innerHTML = `<img src="${profileImgSrc}" alt="Profile" style="width: 34px; height: 34px; border-radius: 50%;">`;
        profilePopup.style.display = "none";
      });

      document
        .querySelector("#profilePopup .cancel-btn")
        .addEventListener("click", () => {
          profilePopup.style.display = "none";
          usernameInput.value = localStorage.getItem("username") || "owner";
          emailInput.value =
            localStorage.getItem("email") || "owner@signaltone.com";
          profileImg.src =
            localStorage.getItem("profileImg") ||
            "https://via.placeholder.com/100";
          profileIcon.innerHTML = `<img src="${profileImg.src}" alt="Profile" style="width: 34px; height: 34px; border-radius: 50%;">`;
        });

      closeProfilePopupBtn.addEventListener("click", () => {
        profilePopup.style.display = "none";
      });

      // Category functionality
      let categories = JSON.parse(localStorage.getItem("categories")) || [];
      const categoryTableBody = document.getElementById("categoryTableBody");
      const categoryCountBtn = document.getElementById("categoryCount");
      const addNewCatBtn = document.getElementById("addNewCatBtn");
      const categoryPopup = document.getElementById("categoryPopup");
      const popupTitle = document.getElementById("popupTitle");
      const categoryForm = document.getElementById("categoryForm");
      const categoryNameInput = document.getElementById("categoryName");
      const categoryDescInput = document.getElementById("categoryDesc");
      const categoryImg = document.getElementById("categoryImg");
      const categoryPhotoInput = document.getElementById("categoryPhotoInput");
      const changeCategoryPhotoBtn = document.getElementById(
        "changeCategoryPhoto"
      );
      const searchInput = document.getElementById("searchInput");
      const closePopupBtn = document.getElementById("closePopupBtn");
      let editingIndex = -1;

      const defaultImage =
        "https://images.unsplash.com/photo-1600585152280-be6161a56a0c?auto=format&fit=crop&w=150&q=80";

      function renderCategories(filter = "") {
        categoryTableBody.innerHTML = "";
        const filteredCategories = categories.filter((cat) =>
          cat.name.toLowerCase().includes(filter.toLowerCase())
        );
        filteredCategories.forEach((cat, index) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${index + 1}</td>
            <td><img src="${cat.image || defaultImage}" alt="${
            cat.name
          }" style="width: 50px; height: 50px;"></td>
            <td>${cat.name}</td>
            <td>${cat.desc}</td>
            <td>
              <button class="edit-category" data-index="${index}">Edit</button>
              <button class="delete-category" data-index="${index}">Delete</button>
            </td>
          `;
          categoryTableBody.appendChild(row);
        });
        categoryCountBtn.textContent = `${categories.length} Categories`;
      }

      renderCategories();

      addNewCatBtn.addEventListener("click", () => {
        popupTitle.textContent = "Add Category";
        categoryNameInput.value = "";
        categoryDescInput.value = "";
        categoryImg.src = defaultImage;
        editingIndex = -1;
        categoryPopup.style.display = "flex";
      });

      changeCategoryPhotoBtn.addEventListener("click", () => {
        categoryPhotoInput.click();
      });

      categoryPhotoInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (event) => {
            categoryImg.src = event.target.result;
          };
          reader.readAsDataURL(file);
        }
      });

      categoryForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const name = categoryNameInput.value;
        const desc = categoryDescInput.value;
        const image = categoryImg.src;

        if (editingIndex === -1) {
          categories.push({ name, desc, image });
        } else {
          categories[editingIndex] = { name, desc, image };
        }

        localStorage.setItem("categories", JSON.stringify(categories));
        renderCategories(searchInput.value);
        categoryPopup.style.display = "none";
      });

      document
        .querySelector("#categoryPopup .cancel-btn")
        .addEventListener("click", () => {
          categoryPopup.style.display = "none";
        });

      closePopupBtn.addEventListener("click", () => {
        categoryPopup.style.display = "none";
      });

      categoryTableBody.addEventListener("click", (e) => {
        if (e.target.classList.contains("edit-category")) {
          const index = e.target.dataset.index;
          const cat = categories[index];
          popupTitle.textContent = "Edit Category";
          categoryNameInput.value = cat.name;
          categoryDescInput.value = cat.desc;
          categoryImg.src = cat.image || defaultImage;
          editingIndex = index;
          categoryPopup.style.display = "flex";
        } else if (e.target.classList.contains("delete-category")) {
          const index = e.target.dataset.index;
          if (confirm("Are you sure you want to delete this category?")) {
            categories.splice(index, 1);
            localStorage.setItem("categories", JSON.stringify(categories));
            renderCategories(searchInput.value);
          }
        }
      });

      searchInput.addEventListener("input", (e) => {
        if (e.target.value.length >= 2) {
          renderCategories(e.target.value);
        } else if (e.target.value.length === 0) {
          renderCategories();
        }
      });

      // Close dropdown when clicking outside
      document.addEventListener("click", (e) => {
        if (
          !profileTrigger.contains(e.target) &&
          !profileDropdown.contains(e.target)
        ) {
          profileDropdown.style.display = "none";
        }
      });

      // import export csv file
      const csvSelect = document.getElementById("csvOptions");
      const importModal = document.getElementById("importModal");
      const exportModal = document.getElementById("exportModal");
      const closeBtns = document.querySelectorAll(".modal .close");

      csvSelect.addEventListener("change", (e) => {
        if (e.target.value === "import") {
          importModal.style.display = "block";
        } else if (e.target.value === "export") {
          exportModal.style.display = "block";
        }
        e.target.value = "";
      });

      closeBtns.forEach((btn) => {
        btn.addEventListener("click", () => {
          btn.closest(".modal").style.display = "none";
        });
      });

      window.addEventListener("click", (e) => {
        if (e.target.classList.contains("modal")) {
          e.target.style.display = "none";
        }
      });

      document
        .getElementById("downloadCsvBtn")
        .addEventListener("click", () => {
          alert("Exporting CSV...");
        });
    </script>
  </body>
</html>